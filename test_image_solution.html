<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŠæˆ¯ç‹ç”»åƒå–å¾— - æœ€çµ‚ãƒ†ã‚¹ãƒˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
        }

        .method-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .method-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .method-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .method-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-badge.testing {
            background: #ffa726;
            color: white;
        }

        .status-badge.success {
            background: #66bb6a;
            color: white;
        }

        .status-badge.failed {
            background: #ef5350;
            color: white;
        }

        .method-description {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .test-image {
            width: 100%;
            max-width: 300px;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            display: block;
            margin: 15px auto;
        }

        .test-controls {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .input-group {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        input[type="number"] {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            width: 200px;
            transition: border-color 0.3s;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .log-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        .log-container {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
        }

        .log-entry {
            margin: 3px 0;
            padding: 3px 0;
        }

        .log-entry.success {
            color: #4ec9b0;
        }

        .log-entry.error {
            color: #f48771;
        }

        .log-entry.info {
            color: #9cdcfe;
        }

        .summary {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .stat-box {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            background: #f5f5f5;
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ´ éŠæˆ¯ç‹ã‚«ãƒ¼ãƒ‰ç”»åƒå–å¾— - çµ±åˆãƒ†ã‚¹ãƒˆ</h1>
            <p class="subtitle">è¤‡æ•°ã®æ–¹æ³•ã‚’åŒæ™‚ã«ãƒ†ã‚¹ãƒˆã—ã¦ã€æœ€é©ãªç”»åƒå–å¾—æ–¹æ³•ã‚’è¦‹ã¤ã‘ã¾ã™</p>
        </div>

        <div class="test-controls">
            <div class="input-group">
                <label for="card-id"><strong>ã‚«ãƒ¼ãƒ‰ID:</strong></label>
                <input type="number" id="card-id" value="7315" placeholder="ä¾‹: 7315 (é’çœ¼ã®ç™½é¾)">
                <button onclick="testAllMethods()">å…¨æ–¹å¼ãƒ†ã‚¹ãƒˆé–‹å§‹</button>
                <button onclick="clearResults()">çµæœã‚¯ãƒªã‚¢</button>
            </div>
        </div>

        <div class="summary" id="summary" style="display: none;">
            <h2>ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼</h2>
            <div class="summary-stats">
                <div class="stat-box">
                    <div class="stat-number" id="tested-count">0</div>
                    <div class="stat-label">ãƒ†ã‚¹ãƒˆæ¸ˆã¿</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="success-count" style="color: #66bb6a;">0</div>
                    <div class="stat-label">æˆåŠŸ</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="failed-count" style="color: #ef5350;">0</div>
                    <div class="stat-label">å¤±æ•—</div>
                </div>
            </div>
        </div>

        <div class="method-grid" id="methods-grid">
            <!-- Methods will be inserted here dynamically -->
        </div>

        <div class="log-section">
            <h2>ğŸ“ å®Ÿè¡Œãƒ­ã‚°</h2>
            <div class="log-container" id="log-container">
                <div class="log-entry info">ãƒ­ã‚°å¾…æ©Ÿä¸­...</div>
            </div>
        </div>
    </div>

    <script>
        const testMethods = [
            {
                id: 'cors-proxy-1',
                name: 'CORSãƒ—ãƒ­ã‚­ã‚· (corsproxy.io)',
                description: 'corsproxy.ioã‚’çµŒç”±ã—ã¦ç”»åƒã‚’å–å¾—',
                test: async (imageUrl) => {
                    const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(imageUrl)}`;
                    return await fetchImage(proxyUrl);
                }
            },
            {
                id: 'cors-proxy-2',
                name: 'CORSãƒ—ãƒ­ã‚­ã‚· (allorigins)',
                description: 'allorigins.winã‚’çµŒç”±ã—ã¦ç”»åƒã‚’å–å¾—',
                test: async (imageUrl) => {
                    const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(imageUrl)}`;
                    return await fetchImage(proxyUrl);
                }
            },
            {
                id: 'blob-url',
                name: 'Blob URLå¤‰æ›',
                description: 'ãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã§å–å¾—ã—ã¦Blob URLã«å¤‰æ›',
                test: async (imageUrl) => {
                    const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(imageUrl)}`;
                    const response = await fetch(proxyUrl);
                    if (!response.ok) throw new Error('Fetch failed');
                    const blob = await response.blob();
                    return URL.createObjectURL(blob);
                }
            },
            {
                id: 'base64',
                name: 'Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰',
                description: 'ãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã§Base64ã«å¤‰æ›',
                test: async (imageUrl) => {
                    const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(imageUrl)}`;
                    const response = await fetch(proxyUrl);
                    if (!response.ok) throw new Error('Fetch failed');
                    const blob = await response.blob();
                    return await blobToBase64(blob);
                }
            },
            {
                id: 'direct-fetch',
                name: 'Direct Fetch',
                description: 'ç›´æ¥fetchï¼ˆå‚è€ƒç”¨ãƒ»å¤±æ•—äºˆæƒ³ï¼‰',
                test: async (imageUrl) => {
                    const response = await fetch(imageUrl, {
                        mode: 'cors',
                        credentials: 'omit'
                    });
                    if (!response.ok) throw new Error('Fetch failed');
                    const blob = await response.blob();
                    return URL.createObjectURL(blob);
                }
            },
            {
                id: 'with-enc',
                name: 'encãƒˆãƒ¼ã‚¯ãƒ³ä»˜ãå–å¾—',
                description: 'ã‚«ãƒ¼ãƒ‰è©³ç´°ãƒšãƒ¼ã‚¸ã‹ã‚‰encãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã¦ç”»åƒå–å¾—',
                test: async (imageUrl, cardId) => {
                    // First get card detail to extract enc token
                    const detailUrl = `https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=2&cid=${cardId}`;
                    const proxyDetailUrl = `https://corsproxy.io/?${encodeURIComponent(detailUrl)}`;

                    const detailResponse = await fetch(proxyDetailUrl);
                    const html = await detailResponse.text();

                    // Extract enc token
                    const encMatch = html.match(/get_image\.action\?type=2&cid=\d+&ciid=1&enc=([a-zA-Z0-9_-]+)/);
                    if (!encMatch) throw new Error('enc token not found');

                    const encToken = encMatch[1];
                    const imageUrlWithEnc = `https://www.db.yugioh-card.com/yugiohdb/get_image.action?type=2&cid=${cardId}&ciid=1&enc=${encToken}`;
                    const proxyImageUrl = `https://corsproxy.io/?${encodeURIComponent(imageUrlWithEnc)}`;

                    return await fetchImage(proxyImageUrl);
                }
            },
            {
                id: 'localhost-proxy',
                name: 'ãƒ­ãƒ¼ã‚«ãƒ«ãƒ—ãƒ­ã‚­ã‚·',
                description: 'Node.jsãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ (localhost:3000)',
                test: async (imageUrl, cardId) => {
                    const localProxyUrl = `http://localhost:3000/image?cid=${cardId}`;
                    return await fetchImage(localProxyUrl);
                }
            },
            {
                id: 'alternative-endpoint',
                name: 'ä»£æ›¿ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ',
                description: 'card_image.actionã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½¿ç”¨',
                test: async (imageUrl, cardId) => {
                    const altUrl = `https://www.db.yugioh-card.com/yugiohdb/card_image.action?cid=${cardId}&request_locale=ja`;
                    const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(altUrl)}`;
                    return await fetchImage(proxyUrl);
                }
            }
        ];

        let stats = { tested: 0, success: 0, failed: 0 };

        async function fetchImage(url) {
            return url;
        }

        function blobToBase64(blob) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(blob);
            });
        }

        function log(message, type = 'info') {
            const container = document.getElementById('log-container');
            const timestamp = new Date().toLocaleTimeString('ja-JP');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${timestamp}] ${message}`;
            container.insertBefore(entry, container.firstChild);

            // Keep only last 100 entries
            while (container.children.length > 100) {
                container.removeChild(container.lastChild);
            }
        }

        function updateStats() {
            document.getElementById('tested-count').textContent = stats.tested;
            document.getElementById('success-count').textContent = stats.success;
            document.getElementById('failed-count').textContent = stats.failed;
            document.getElementById('summary').style.display = 'block';
        }

        async function testAllMethods() {
            const cardId = document.getElementById('card-id').value;
            if (!cardId) {
                alert('ã‚«ãƒ¼ãƒ‰IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            // Reset stats
            stats = { tested: 0, success: 0, failed: 0 };
            updateStats();

            log(`ã‚«ãƒ¼ãƒ‰ID ${cardId} ã®ãƒ†ã‚¹ãƒˆé–‹å§‹`, 'info');

            const baseImageUrl = `https://www.db.yugioh-card.com/yugiohdb/get_image.action?type=2&cid=${cardId}&ciid=1`;

            // Create method cards
            const grid = document.getElementById('methods-grid');
            grid.innerHTML = '';

            for (const method of testMethods) {
                const card = createMethodCard(method);
                grid.appendChild(card);

                // Start test
                testMethod(method, baseImageUrl, cardId);
            }
        }

        function createMethodCard(method) {
            const card = document.createElement('div');
            card.className = 'method-card';
            card.id = `card-${method.id}`;

            card.innerHTML = `
                <div class="method-header">
                    <div class="method-title">${method.name}</div>
                    <div class="status-badge testing" id="badge-${method.id}">ãƒ†ã‚¹ãƒˆä¸­</div>
                </div>
                <div class="method-description">${method.description}</div>
                <div id="result-${method.id}">
                    <div class="spinner"></div>
                </div>
            `;

            return card;
        }

        async function testMethod(method, baseImageUrl, cardId) {
            log(`[${method.name}] ãƒ†ã‚¹ãƒˆé–‹å§‹`, 'info');

            try {
                const imageUrl = await method.test(baseImageUrl, cardId);

                // Try to load image
                const img = new Image();
                img.className = 'test-image';

                await new Promise((resolve, reject) => {
                    img.onload = () => {
                        stats.tested++;
                        stats.success++;
                        updateStats();
                        log(`[${method.name}] âœ“ æˆåŠŸ`, 'success');

                        document.getElementById(`badge-${method.id}`).textContent = 'æˆåŠŸ';
                        document.getElementById(`badge-${method.id}`).className = 'status-badge success';
                        document.getElementById(`result-${method.id}`).innerHTML = '';
                        document.getElementById(`result-${method.id}`).appendChild(img);

                        resolve();
                    };

                    img.onerror = () => {
                        reject(new Error('Image load failed'));
                    };

                    img.src = imageUrl;

                    // Timeout after 10 seconds
                    setTimeout(() => reject(new Error('Timeout')), 10000);
                });

            } catch (error) {
                stats.tested++;
                stats.failed++;
                updateStats();
                log(`[${method.name}] âœ— å¤±æ•—: ${error.message}`, 'error');

                document.getElementById(`badge-${method.id}`).textContent = 'å¤±æ•—';
                document.getElementById(`badge-${method.id}`).className = 'status-badge failed';
                document.getElementById(`result-${method.id}`).innerHTML = `
                    <div style="color: #ef5350; padding: 10px; text-align: center;">
                        âœ— ${error.message}
                    </div>
                `;
            }
        }

        function clearResults() {
            document.getElementById('methods-grid').innerHTML = '';
            document.getElementById('log-container').innerHTML = '<div class="log-entry info">ãƒ­ã‚°ã‚¯ãƒªã‚¢</div>';
            stats = { tested: 0, success: 0, failed: 0 };
            updateStats();
        }

        // Initialize
        log('ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†', 'success');
        log('ã‚«ãƒ¼ãƒ‰IDã‚’å…¥åŠ›ã—ã¦ã€Œå…¨æ–¹å¼ãƒ†ã‚¹ãƒˆé–‹å§‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„', 'info');
    </script>
</body>
</html>
