# battle_records.html 保存機能バグ調査

## 発生日時: 2025-08-19

## 問題
- 保存ボタンを押しても読み込み画面が続き、保存されない

## 調査結果

### saveRecord関数の問題点
1. **saveLocalRecord関数の戻り値がない**
   - 712行目: `saveLocalRecord(recordId, recordData);` を呼び出しているが、この関数は値を返さない
   - そのため処理が正常に完了しても、724行目の`loadRecords()`が呼ばれない可能性

2. **エラーハンドリングの不足**
   - saveLocalRecord内でエラーが発生してもキャッチされない
   - recordModal.hide()が呼ばれずモーダルが閉じない

3. **非同期処理の不整合**
   - saveLocalRecordは同期関数だが、loadRecordsは非同期関数
   - await loadRecords()にすべき

## 修正案
1. saveLocalRecord関数を修正して適切に処理を完了させる
2. loadRecords()をawaitで呼び出す
3. エラーハンドリングを改善

## 追加要件
- 先攻後攻選択欄の追加
- マッチ戦の各ゲーム詳細（1戦目、2戦目、3戦目の勝敗）
- スコア欄の削除